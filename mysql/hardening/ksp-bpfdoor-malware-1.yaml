# KubeArmor is an open source software that enables you to protect your cloud workload at run-time.
# To learn more about KubeArmor visit:
# https://www.accuknox.com/kubearmor/

apiVersion: security.kubearmor.com/v1
kind: KubeArmorPolicy
metadata:
  name: ksp-bpfdoor-malware-1
  namespace: explorer
spec:
  tags: ["BPF", "BPFDOOR","MALWARE"]
  message: "Alert! /dev/shm/kdmtmpflush file detected possible bpfdoor malware."
  selector:
    matchLabels:
      app.kubernetes.io/instance: mysql
      app.kubernetes.io/name: mysql
      controller-revision-hash: mysql-79b68f887f
      helm.sh/chart: mysql-9.1.4
      statefulset.kubernetes.io/pod-name: mysql-0
  process:
    severity: 1
    matchPaths:
    - path: /dev/shm/kdmtmpflush
    - path: /dev/shm/kdevtmpfls
    - path: /dev/shm/ff
    - path: /run/lock/kdumpflush
    - path: /run/lock/kdumpcab
    - path: /var/lock/kdumpcab
    - path: /var/lock/kdumpcache
    - path: /var/run/haldrund.pid
    - path: /etc/avahi/avahi.conf
    - path: /etc/cups/cups
    - path: /etc/cups/cups.conf
    - path: /etc/gofer/gofor.conf
    - path: /etc/gss/gss.conf
    - path: /etc/jvm/jvm.conf
    - path: /etc/ntp/ntpd
    - path: /etc/opt/opt.conf
    - path: /etc/pm/pm.conf
    - path: /etc/pulp/agent.conf
    - path: /etc/ssl/ssl.conf
    - path: /etc/sysconfig/kdumplog
    - path: /etc/sysconfig/nfs.conf
    - path: /etc/sysconfig/pcscd.conf
    - path: /etc/xdg/xdg.conf
    - path: /usr/java/jdk1.8.0_181-amd64/.java/init.d/jexecd
    - path: /usr/local/mysql/bin/myisambug
    - path: /lib64/libcaac.so.1
    - path: /run/lock/lvv
    - path: /run/lock/lvm/lv
    - path: /var/run/lvm/vm
    - path: /dev/shm/sem
    # Linux binaries for active recon
    - path: /usr/local/bin/ldapdomaindump
    - path: /usr/local/bin/ldd2bloodhound
    # Solaris OS paths and directories
    - path: /lib/librbtinfo.so.1
    - path: /usr/lib/autofs/mountd
    - path: /opt/VRTSvcs/bin/IP/online_Agent
    - path: /tmp/getuid.so
    - path: /usr/lib/secure/getuid.so
    # Linux post-exploitation paths
    - path: /usr/local/bin/GetADUsers.py
    - path: /usr/local/bin/GetNPUsers.py
    - path: /usr/local/bin/GetUserSPNs.py
    - path: /usr/local/bin/atexec.py
    - path: /usr/local/bin/dcomexec.py
    - path: /usr/local/bin/dpapi.py
    - path: /usr/local/bin/esentutl.py
    - path: /usr/local/bin/getArch.py
    - path: /usr/local/bin/getPac.py
    - path: /usr/local/bin/getST.py
    - path: /usr/local/bin/getTGT.py
    - path: /usr/local/bin/goldenPac.py
    - path: /usr/local/bin/ifmap.py
    - path: /usr/local/bin/karmaSMB.py
    - path: /usr/local/bin/lookupsid.py
    - path: /usr/local/bin/mimikatz.py
    - path: /usr/local/bin/mqtt_check.py
    - path: /usr/local/bin/mssqlclient.py
    - path: /usr/local/bin/mssqlinstance.py
    - path: /usr/local/bin/netview.py
    - path: /usr/local/bin/nmapAnswerMachine.py
    - path: /usr/local/bin/ntfs-read.py
    - path: /usr/local/bin/ntlmrelayx.py
    - path: /usr/local/bin/opdump.py
    - path: /usr/local/bin/ping.py
    - path: /usr/local/bin/ping6.py
    - path: /usr/local/bin/psexec.py
    - path: /usr/local/bin/raiseChild.py
    - path: /usr/local/bin/rdp_check.py
    - path: /usr/local/bin/reg.py
    - path: /usr/local/bin/registry-read.py
    - path: /usr/local/bin/rpcdump.py
    - path: /usr/local/bin/sambaPipe.py
    - path: /usr/local/bin/samrdump.py
    - path: /usr/local/bin/secretsdump.py
    - path: /usr/local/bin/services.py
    - path: /usr/local/bin/smbclient.py
    - path: /usr/local/bin/smbexec.py
    - path: /usr/local/bin/smbrelayx.py
    - path: /usr/local/bin/smbserver.py
    - path: /usr/local/bin/sniff.py
    - path: /usr/local/bin/sniffer.py
    - path: /usr/local/bin/split.py
    - path: /usr/local/bin/ticketer.py
    - path: /usr/local/bin/wmiexec.py
    - path: /usr/local/bin/wmipersist.py
    - path: /usr/local/bin/wmiquery.py
    matchPatterns:
    - pattern: dbus-daemon
    - pattern: justtryit
    - pattern: justrobot
    - pattern: justforfun
  action: Audit

